\usepackage{hyperref}

\newtheoremrep{theorem}{Theorem}
\newtheoremrep{lemma}[theorem]{Lemma}

\newtheoremrep{example}{Example}[section]

\renewcommand{\appendixsectionformat}[2]{Material for #2 (Section~#1)}
\renewcommand{\appendixrefname}{Appendix References}

\title{Title}
\author{Author}

\begin{document}

\maketitle

Hello world!

\begin{theoremrep}
  \label{th:toto}
  This is a great result. It has an equation:
  \begin{equation}
    \label{eq:myeqn}
    \sum_{k=1}^\infty \frac1{k^2}=\frac{\pi^2}6
 \end{equation}
\end{theoremrep}

The equation number is~(\ref{eq:myeqn}).

\begin{proofsketch}
  This is the proof sketch of Theorem~\ref{th:toto}.
\end{proofsketch}

\begin{proof}
  This is the proof of Theorem~\ref{th:toto}.
\end{proof}

\section{Section without Theorems}

Since this section does not have any appendix content, it will not appear in the
appendix. \cite{brin1998anatomy}

\section{Section with Some Appendix Content}

\begin{example}
  Examples are numbered within a section.
\end{example}

Not much in the main text.

\begin{toappendix}
  Hello appendix!
\end{toappendix}

\section[Section with Theorems (short)]%
        {Section with Theorems (long)}

\begin{theoremrep}
  \label{th:titi}
  Another great result.
\end{theoremrep}

\begin{proofsketch}
  Proof sketch of Theorem~\ref{th:titi}.
\end{proofsketch}

\begin{proof}
  Proof of Theorem~\ref{th:titi}.

  For some reason, this proof has an inline Lemma:
  \begin{lemma}
    This is the lemma (numbered following the theorem numbering).
  \end{lemma} 

  \begin{nestedproof}
    And this lemma has a proof as well!
  \end{nestedproof}

  This concludes the global proof of Theorem~\ref{th:titi}.
\end{proof}

\begin{theoremrep}
  \label{th:tutu}
  Another great result, without any proof sketch.
\end{theoremrep}

\begin{proof}
  Proof of Theorem~\ref{th:tutu}. It has two
  references~\cite{sitemaps,brin1998anatomy}.
\end{proof}

\begin{theorem}
  A regular theorem, not repeated.
\end{theorem}

\begin{proof}
This regular theorem is naturally followed with an inline proof.
\end{proof}

\begin{theoremrep}
  \label{th:weird}
  A repeated theorem, but with two proofs, one in Appendix and one in
  main text.
\end{theoremrep}

\begin{inlineproof}
  Main text proof of Theorem~\ref{th:weird}.
\end{inlineproof}

\begin{proof}
  Appendix proof of Theorem~\ref{th:weird}.
\end{proof}

\begin{toappendix}
And now for no particular reason, two isolated proofs in the appendix,
  written in two different ways:

  \begin{proof}[Proof of a non-existing result]
    First with a regular \texttt{proof} environment inside a
    \texttt{toappendix} environment.
  \end{proof}
\end{toappendix}

\begin{appendixproof}
  Second, with the specific \texttt{appendixproof} environment (but then,
  cannot change the proof name).
\end{appendixproof}

\section{Last \textit{Section}}

\begin{theoremrep}[(with note)]
  Another theorem.
\end{theoremrep}

\begin{toappendix}
  This theorem does not have a proof, but a discussion in the appendix.
  \textsf{apxproof} can figure, because of the \verb|theorem| environment
  that follows, that the proof of the following theorem is not a proof of
  this theorem.
\end{toappendix}

\begin{theorem}
  Last theorem, not repeated.
\end{theorem}

\begin{proof}
  Proof, inlined.
\end{proof}

\bibliographystyle{plain}
\bibliography{../common}

\end{document}
